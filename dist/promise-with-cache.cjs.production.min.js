"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=new Map,c=new Map,t=new Map;exports.default=function(){function r(r,n){var a=this;this.get=function(){if(!a.cacheKey||"function"!=typeof a.promiseFunc){var r=new Error("cacheKey or promiseFunc can not be empty");return Promise.reject(r)}if(c.has(a.cacheKey)){var n=c.get(a.cacheKey);if("complete"===n)return Promise.resolve(t.get(a.cacheKey));if("pending"===n)return new Promise((function(c,t){e.has(a.cacheKey)?e.get(a.cacheKey).push({onSuccess:c,onError:t}):e.set(a.cacheKey,[{onSuccess:c,onError:t}])}))}return c.set(a.cacheKey,"pending"),a.promiseFunc().then((function(r){return c.set(a.cacheKey,"complete"),t.set(a.cacheKey,r),e.has(a.cacheKey)&&(e.get(a.cacheKey).forEach((function(e){e.onSuccess(r)})),e.delete(a.cacheKey)),r}),(function(t){return c.delete(a.cacheKey),e.has(a.cacheKey)&&(e.get(a.cacheKey).forEach((function(e){e.onError(t)})),e.delete(a.cacheKey)),Promise.reject(t)}))},this.getCacheKey=function(){return a.cacheKey},this.clearCache=function(){a.cacheKey&&(e.delete(a.cacheKey),c.delete(a.cacheKey),t.delete(a.cacheKey))},this.forceUpdate=function(){return a.clearCache(),a.get()},this.promiseFunc=r,this.cacheKey=null!=n?n:this.generateCacheKey()}return r.prototype.generateCacheKey=function(){return e=(new Date).getTime(),c="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0,"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=16*Math.random();return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(c+r)%16|0,c=Math.floor(c/16)),("x"===t?r:3&r|8).toString(16)}));var e,c},r.clearCache=function(r){null==r?(e.clear(),c.clear(),t.clear()):(e.delete(r),c.delete(r),t.delete(r))},r}();
//# sourceMappingURL=promise-with-cache.cjs.production.min.js.map
